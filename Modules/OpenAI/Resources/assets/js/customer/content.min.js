"use strict";function hideProviderOptions(){$(".ProviderOptions").each((function(){$(this).addClass("hidden")}))}$(".AdavanceOption").on("click",(function(){"hidden"==$("#ProviderOptionDiv").attr("class")?(hideProviderOptions(),$("."+$("#provider option:selected").val()+"_div").removeClass("hidden"),$("#ProviderOptionDiv").removeClass("hidden")):$("#ProviderOptionDiv").addClass("hidden")})),$("#provider").on("change",(function(){hideProviderOptions(),$("."+$(this).val()+"_div").removeClass("hidden")})),$("#provider").on("change",(function(){hideProviderOptions(),$("."+$(this).val()+"_div").removeClass("hidden")})),$(document).on("submit","#openai-form",(function(e){let dataArray=$(this).serializeArray();var providerObject=dataArray.find((function(element){return"provider"===element.name}));function getValueByName(name){var item=dataArray.find((function(element){return element.name===name}));return item?item.value:null}var providerValue=providerObject?providerObject.value:null;let contentSlug="";var currentUrl;window.location.href.indexOf("content/edit")>-1&&(parts=window.location.href.split("/"),contentSlug=parts[parts.length-1]),e.preventDefault();var gethtml=tinyMCE.activeEditor.getContent(),formData={};$(".dynamic-input").each((function(column){formData[this.name]=$(this).val()}));var url=SITE_URL+"/user/generate",newUrl=SITE_URL+"/user/process",questions=JSON.stringify(formData),variant=getValueByName(`${providerValue}[variant]`),language=getValueByName(`${providerValue}[language]`),model=getValueByName(`${providerValue}[model]`);function convertMarkdownToHTML(text){return text.replace(/^## (.*)$/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}$.ajax({url:url,type:"POST",beforeSend:function(xhr){$(".loader").removeClass("hidden"),$("#magic-submit-button").prop("disabled",!0),xhr.setRequestHeader("Authorization","Bearer "+ACCESS_TOKEN)},data:{questions:questions,prompt:filterXSS($("#promt").val()),useCase:$(".use-cases").val(),language:language,variant:variant,model:model,tone:getValueByName(`${providerValue}[tone]`),creativity_level:getValueByName(`${providerValue}[creativity_level]`),provider:$("#provider").val(),previousContent:gethtml,contentSlug:contentSlug,dataType:"json",_token:CSRF_TOKEN},success:function(response){if(response.status="success"){var url=newUrl+"?questions="+encodeURIComponent(questions)+"&provider="+$("#provider").val()+"&useCase="+$(".use-cases").val()+"&language="+language+"&variant="+variant+"&model="+model+"&tone="+$("#tone").val()+"&creativity_level="+$("#creativity_level").val()+"&template_id="+decodeURIComponent(response.data.templateId);const eventSource=new EventSource(url,{withCredentials:!0});eventSource.onmessage=function(e){if("[DONE]"===e.data)eventSource.close(),toastMixin.fire({title:jsLang("Document generated successfully."),icon:"success"}),$(".loader").addClass("hidden"),$("#magic-submit-button").removeAttr("disabled"),updateEditorThrottled();else if("[ERROR]"===e.data)eventSource.close(),errorMessage(e.data,"magic-submit-button");else{const stream=e.data;stream&&"[DONE]"!==stream&&(gethtml+=stream,updateEditorThrottled())}},eventSource.addEventListener("error",e=>{eventSource.close(),errorMessage(e.data,"magic-submit-button")})}},error:function(response){var jsonData=JSON.parse(response.responseText),message=jsonData.error?jsonData.error:jsonData.message;errorMessage(message,"magic-submit-button")}});let lastUpdate=0,lastContent="";const throttleInterval=50;function updateEditorThrottled(){const now=Date.now();if(!(now-lastUpdate<50))try{const parsedHtml=convertMarkdownToHTML(gethtml);parsedHtml!==lastContent&&tinyMCE.activeEditor&&(tinyMCE.activeEditor.setContent(parsedHtml),lastContent=parsedHtml),lastUpdate=now}catch(error){errorMessage(error,"magic-submit-button")}}}));